---
  # Repo and tor are installed in common role
- include: create_app_dirs.yml

- include: app_install_fpf_deb_pkgs.yml
  when: securedrop_app_install_from_repo

- include: initialize_securedrop_app.yml

# If HTTPS is enabled, certs must land before Apache vhost configs
# are written, otherwise the Apache enmod tasks will fail.
- include: copy_ssl_certs.yml
  when:
    - securedrop_app_https_on_source_interface

- include: install_and_harden_apache.yml

- include: configure_securedrop_worker.yml

- include: setup_cron.yml

- include: configure_haveged.yml

# ./manage.py were-there-submissions-today runs every night as a cron. If the
# instance is rebooted prior to the cron running a first time, a SecureDrop
# Submissions error is sent to the admin.
# (see https://github.com/freedomofpress/securedrop/issues/3393)
- include: run_were_there_submissions_today.yml
  when:
    - journalist_gpg_fpr is defined
    - journalist_gpg_fpr != ""
    - journalist_alert_gpg_public_key is defined
    - journalist_alert_gpg_public_key != ""
    - journalist_alert_email is defined
    - journalist_alert_email != ""
