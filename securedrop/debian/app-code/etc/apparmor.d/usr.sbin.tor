# Last Modified: Fri Mar 28 23:54:25 2014
#include <tunables/global>
/usr/sbin/tor flags=(complain) {
  #include <abstractions/apache2-common>
  #include <abstractions/base>
  #include <abstractions/tor>

  capability setgid,

  /dev/null rw,
  /dev/urandom r,
  /etc/ld.so.cache r,
  /etc/localtime r,
  /etc/nsswitch.conf r,
  /etc/passwd r,
  /etc/tor/torrc r,
  /lib/x86_64-linux-gnu/libc-*.so mr,
  /lib/x86_64-linux-gnu/libcrypto.so.* mr,
  /lib/x86_64-linux-gnu/libdl-*.so mr,
  /lib/x86_64-linux-gnu/libm-*.so mr,
  /lib/x86_64-linux-gnu/libnsl-*.so mr,
  /lib/x86_64-linux-gnu/libnss_compat-*.so mr,
  /lib/x86_64-linux-gnu/libnss_files-*.so mr,
  /lib/x86_64-linux-gnu/libnss_nis-*.so mr,
  /lib/x86_64-linux-gnu/libpthread-*.so mr,
  /lib/x86_64-linux-gnu/librt-*.so mr,
  /lib/x86_64-linux-gnu/libssl.so.* mr,
  /lib/x86_64-linux-gnu/libz.so.* mr,
  /proc/meminfo r,
  /proc/stat r,
  /proc/sys/kernel/random/uuid r,
  /run/tor/control w,
  /run/tor/control.authcookie w,
  /run/tor/control.authcookie.tmp rw,
  /run/tor/tor.pid w,
  /usr/sbin/tor mr,
  /usr/lib/lib*so* mr,
  /usr/share/tor/geoip r,
  /usr/share/tor/geoip6 r,
  /usr/share/tor/tor-service-defaults-torrc r,
  /var/lib/tor/cached-certs rw,
  /var/lib/tor/cached-certs.tmp rw,
  /var/lib/tor/cached-microdesc-consensus rw,
  /var/lib/tor/cached-microdesc-consensus.tmp rw,
  /var/lib/tor/cached-microdescs r,
  /var/lib/tor/cached-microdescs.new rw,
  /var/lib/tor/services/ w,
  /var/lib/tor/services/client_keys rw,
  /var/lib/tor/services/client_keys.tmp rw,
  /var/lib/tor/services/hostname w,
  /var/lib/tor/services/hostname.tmp rw,
  /var/lib/tor/sevices/private_key rw,
  /var/lib/tor/services/private_key.tmp rw,
  /var/lib/tor/services/sourcev3/ w,
  /var/lib/tor/services/sourcev3/hostname rw,
  /var/lib/tor/services/sourcev3/hs_ed25519_public_key rw,
  /var/lib/tor/services/sourcev3/hs_ed25519_secret_key rw,
  /var/lib/tor/services/journalistv3/ w,
  /var/lib/tor/services/journalistv3/hostname rw,
  /var/lib/tor/services/journalistv3/hs_ed25519_public_key rw,
  /var/lib/tor/services/journalistv3/hs_ed25519_secret_key rw,
  /var/lib/tor/services/journalistv3/authorized_keys/ w,
  /var/lib/tor/services/journalistv3/authorized_keys/client.auth r,
  /var/lib/tor/services/sshv3/ w,
  /var/lib/tor/services/sshv3/hostname rw,
  /var/lib/tor/services/sshv3/hs_ed25519_public_key rw,
  /var/lib/tor/services/sshv3/hs_ed25519_secret_key rw,
  /var/lib/tor/services/sshv3/authorized_keys/ w,
  /var/lib/tor/services/sshv3/authorized_keys/client.auth r,
  /var/lib/tor/lock rwk,
  /var/lib/tor/state rw,
  /var/lib/tor/state.tmp rw,
  /var/lib/tor/unverified-microdesc-consensus w,
  /var/lib/tor/unverified-microdesc-consensus.tmp rw,
  /var/log/tor/log w,
}
