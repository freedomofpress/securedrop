{% extends "base.html" %}
{% block body %}
<h1>Admin Interface</h1>

<form action="{{ url_for('admin_add_user') }}">
  <button class="sd-button" type="submit" class="btn" id="add-user">ADD USER</button>
</form>

<hr class="no-line" />

{% if users %}
<form id="user_actions" method="post">
  <input name="csrf_token" type="hidden" value="{{ csrf_token() }}"/>
  <table id="users">
    <tr>
      <th>Username</th>
      <th>Edit</th>
      <th>Delete</th>
      <th>Created</th>
      <th>Last login</th>
    </tr>
    {% for user in users %}
      <tr class="user">
        <td>{{ user.username }}</td>
        <td><a href="/admin/edit/{{ user.id }}" class="plain" data-username="{{ user.username }}"><i class="fa fa-edit" title="Edit user {{ user.username }}"></i></a></td>
        <td><button type="submit" class="plain delete-user" formaction="/admin/delete/{{ user.id }}" data-username="{{ user.username}}"><i class="fa fa-trash-o" title="Delete user {{ user.username }}"></i></button></td>
        <td><time class="date" title="{{ user.created_on }}">{{ user.created_on|datetimeformat(relative=True) }}</time></td>
        {% if user.last_access %}
          <td><time class="date" title="{{ user.last_access }}">{{ user.last_access|datetimeformat(relative=True) }}</time></td>
        {% else %}
          <td><time class="date">Never</time></td>
        {% endif %}
      </tr>
    {% endfor %}
  </table>
</form>
{% else %}
<p>No users to display</p>
{% endif %}

<h2>Add/Delete Label Types</h2>
<p><b>Operational Security Warning:</b> Note that these labels are stored in plaintext on the
SecureDrop server.</p>

<p>
  <form id="source_tag_creation" method="post">
    <input name="csrf_token" type="hidden" value="{{ csrf_token() }}" />
    <input id="source_tag_creation_text" name="label_text" type="text" placeholder="Label Text" />
    <button id="source_tag_creation_submit" type="submit" class="btn" formaction="/admin/create_source_label_type/{{ label_text }}"><i class="fa fa-plus"></i> Add source label</button>
    {% with errors = get_flashed_messages(category_filter=["source-label-error"]) %}{% if errors %}
      <div class="error">
        {% for error in errors %}
        {{ error }}
        {% endfor %}
      </div>
      {% endif %}
    {% endwith %}
  </form>

  {% for tag in source_tags %}
    <form id="source_tag_actions" method="post">
      <input name="csrf_token" type="hidden" value="{{ csrf_token() }}" />
      <button id="source_tag_{{ tag.id }}" type="submit" class="tag-label" formaction="/admin/delete_source_label_type/{{ tag.id }}">{{ tag.label_text }} <i class="fa fa-times" aria-hidden="true"></i></button>
    </form>
  {% endfor %}
</p>

<p>
  <form id="submission_tag_creation" method="post">
    <input name="csrf_token" type="hidden" value="{{ csrf_token() }}" />
    <input id="submission_tag_creation_text" name="label_text" type="text" placeholder="Label Text" />
    <button id="submission_tag_creation_submit" type="submit" class="btn" formaction="/admin/create_submission_label_type/{{ label_text }}"><i class="fa fa-plus"></i> Add submission label</button>
    {% with errors = get_flashed_messages(category_filter=["submission-label-error"]) %}{% if errors %}
      <div class="error">
        {% for error in errors %}
        {{ error }}
        {% endfor %}
      </div>
      {% endif %}
    {% endwith %}
  </form>

  {% for tag in submission_tags %}
    <form id="submission_tag_actions" method="post">
      <input name="csrf_token" type="hidden" value="{{ csrf_token() }}" />
      <button id="submission_tag_{{ tag.id }}" type="submit" class="tag-label" formaction="/admin/delete_submission_label_type/{{ tag.id }}">{{ tag.label_text }} <i class="fa fa-times" aria-hidden="true"></i></button>
    </form>
  {% endfor %}
</p>

{% endblock %}
